# Face Recognition System

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ FastAPI –∏ InsightFace –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª—é–¥–µ–π –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ REST API.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü** - –±—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª—é–¥–µ–π –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >99%
- üìà **–ê–≤—Ç–æ–æ–±—É—á–µ–Ω–∏–µ** - —É—Å–ø–µ—à–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ —Ñ–æ—Ç–æ –≤ –±–∞–∑—É
- üë• **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª—é–¥—å–º–∏** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ª—é–¥–µ–π
- üì∏ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π** - drag-and-drop –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
- üìä **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ª—é–¥—è–º, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- üéØ **–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ InsightFace buffalo_l
- üñ•Ô∏è **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å Bootstrap 5
- üöÄ **REST API** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- ‚ö° **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üîí **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **SQLAlchemy** - –º–æ—â–Ω–∞—è ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **SQLite** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ PostgreSQL)
- **InsightFace** - –ø–µ—Ä–µ–¥–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü
- **OpenCV** - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è
- **Pydantic** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- **Bootstrap 5** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **Jinja2** - –º–æ—â–Ω—ã–π —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä –¥–ª—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü

## üìã –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python** 3.8+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.11+)
- **–û–ó–£**: –º–∏–Ω–∏–º—É–º 4GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8GB+
- **–î–∏—Å–∫**: ~3GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–º–æ–¥–µ–ª–∏ InsightFace + –¥–∞–Ω–Ω—ã–µ)
- **–û–°**: Linux, macOS, Windows
- **CPU**: –ª—é–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è CPU)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone git@github.com:naumovmag/FaceId.git
cd FaceId

# –°–æ–∑–¥–∞–π—Ç–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv .venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:
# Linux/macOS:
source .venv/bin/activate
# Windows:
.venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade pip
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
nano .env
```

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
APP_HOST=127.0.0.1          # –•–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
APP_PORT=8000               # –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
DEBUG=True                  # –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
SECRET_KEY=your_secret_key  # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–∏–∑–º–µ–Ω–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!)

# –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ª–∏—Ü
FACE_RECOGNITION_THRESHOLD=0.6  # –ü–æ—Ä–æ–≥ —Å—Ö–æ–¥—Å—Ç–≤–∞ (0.4-0.8)
MAX_UPLOAD_SIZE=10485760       # –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (10MB)

# –ü—É—Ç–∏
UPLOAD_PATH=./uploads          # –ü—É—Ç—å –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫
MODELS_CACHE_PATH=./models_cache  # –ö—ç—à –º–æ–¥–µ–ª–µ–π
```

> üí° **–í–∞–∂–Ω–æ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ `SECRET_KEY` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–æ–∫—Ä—É–∂–µ–Ω–∏—è!

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫
python run.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ uvicorn –Ω–∞–ø—Ä—è–º—É—é
uvicorn app.main:app --host 127.0.0.1 --port 8000 --reload
```

üåê **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://127.0.0.1:8000**

### 4. –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤—å—Ç–µ –ª—é–¥–µ–π**: –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–õ—é–¥–∏" ‚Üí "–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞"
2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏**: –≤ —Ä–∞–∑–¥–µ–ª–µ "–ó–∞–≥—Ä—É–∑–∫–∞" –¥–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ**: –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è" –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –ø–æ–∏—Å–∫–∞

## üíª –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- **üè† –ì–ª–∞–≤–Ω–∞—è** (`/`) - –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –∏ –±—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏
- **üîç –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (`/identify`) - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- **üì§ –ó–∞–≥—Ä—É–∑–∫–∞** (`/upload`) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –ø—Ä–æ—Ñ–∏–ª—è–º –ª—é–¥–µ–π
- **üë• –õ—é–¥–∏** (`/persons`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ª—é–¥–µ–π
- **‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** (`/training`) - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

### REST API 

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **üìñ Swagger UI**: http://127.0.0.1:8000/docs
- **üìö ReDoc**: http://127.0.0.1:8000/redoc

#### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

**üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª—é–¥—å–º–∏:**
```bash
POST   /api/persons           # –°–æ–∑–¥–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
GET    /api/persons           # –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π  
GET    /api/persons/{id}      # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–µ–ª–æ–≤–µ–∫–µ
PUT    /api/persons/{id}      # –û–±–Ω–æ–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
DELETE /api/persons/{id}      # –£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
GET    /api/persons/{id}/stats # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ–ª–æ–≤–µ–∫–∞
```

**üì∏ –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏:**
```bash
POST   /api/persons/{id}/photos  # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
DELETE /api/photos/{id}          # –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ
```

**üîç –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
```bash
POST   /api/identify  # –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –ª–∏—Ü–æ –ø–æ —Ñ–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ person_id –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏)
```

**üìä –°–∏—Å—Ç–µ–º–∞:**
```bash
GET    /api/health    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
GET    /api/stats     # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```

## üìñ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python API –∫–ª–∏–µ–Ω—Ç

```python
import requests
import json

BASE_URL = "http://127.0.0.1:8000/api"

# –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞
def create_person(name: str):
    response = requests.post(f"{BASE_URL}/persons", 
                           json={"name": name})
    return response.json()

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
def upload_photo(person_id: int, image_path: str):
    with open(image_path, "rb") as f:
        files = {"file": f}
        response = requests.post(f"{BASE_URL}/persons/{person_id}/photos", 
                               files=files)
    return response.json()

# –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–∞
def identify_face(image_path: str):
    with open(image_path, "rb") as f:
        files = {"file": f}
        response = requests.post(f"{BASE_URL}/identify", 
                               files=files)
    return response.json()

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    # 1. –°–æ–∑–¥–∞–µ–º —á–µ–ª–æ–≤–µ–∫–∞
    person = create_person("–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤")
    print(f"–°–æ–∑–¥–∞–Ω —á–µ–ª–æ–≤–µ–∫: {person}")
    
    # 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ
    photo_result = upload_photo(person["id"], "ivan_photo.jpg")
    print(f"–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {photo_result}")
    
    # 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
    identify_result = identify_face("test_photo.jpg")
    if identify_result["is_match"]:
        print(f"‚úÖ –ù–∞–π–¥–µ–Ω: {identify_result['person_name']}")
        print(f"   –°—Ö–æ–¥—Å—Ç–≤–æ: {identify_result['similarity']:.1%}")
    else:
        print("‚ùå –õ–∏—Ü–æ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ")
```

### cURL –ø—Ä–∏–º–µ—Ä—ã

```bash
# –°–æ–∑–¥–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–∞
curl -X POST "http://127.0.0.1:8000/api/persons" \
     -H "Content-Type: application/json" \
     -d '{"name": "–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞"}'

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é
curl -X POST "http://127.0.0.1:8000/api/persons/1/photos" \
     -F "file=@photo.jpg"

# –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Ü–æ
curl -X POST "http://127.0.0.1:8000/api/identify" \
     -F "file=@unknown_face.jpg"

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl "http://127.0.0.1:8000/api/stats"
```

### JavaScript (–±—Ä–∞—É–∑–µ—Ä)

```javascript
// –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–∞ —á–µ—Ä–µ–∑ JavaScript
async function identifyFace(fileInput) {
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    
    try {
        const response = await fetch('/api/identify', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.is_match) {
            console.log(`–ù–∞–π–¥–µ–Ω: ${result.person_name}`);
            console.log(`–°—Ö–æ–¥—Å—Ç–≤–æ: ${(result.similarity * 100).toFixed(1)}%`);
        } else {
            console.log('–õ–∏—Ü–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
    }
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
face_recognition_app/
‚îú‚îÄ‚îÄ üìÅ app/                    # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö  
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ person.py          # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py        # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ face_service.py    # –°–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏—Ü
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ person_service.py  # –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª—é–¥—å–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_service.py    # –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ routes/             # –ú–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.py             # REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ web.py             # –í–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.py      # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py      # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.py                # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª FastAPI
‚îú‚îÄ‚îÄ üìÅ static/                 # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ css/
‚îÇ       ‚îî‚îÄ‚îÄ style.css          # –°—Ç–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ üìÅ templates/              # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ base.html              # –ë–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ index.html             # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ identify.html          # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ upload.html            # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
‚îÇ   ‚îú‚îÄ‚îÄ persons_list.html      # –°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ person_detail.html     # –î–µ—Ç–∞–ª–∏ —á–µ–ª–æ–≤–µ–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ training.html          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π
‚îÇ   ‚îî‚îÄ‚îÄ results.html           # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ üìÅ uploads/                # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ persons/            # –§–æ—Ç–æ –ª—é–¥–µ–π (–ø–æ ID)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ temp/               # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ debug/              # –§–∞–π–ª—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
‚îú‚îÄ‚îÄ üìÅ models_cache/           # –ö—ç—à –º–æ–¥–µ–ª–µ–π InsightFace
‚îú‚îÄ‚îÄ üìÑ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ üìÑ .env.example            # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ üìÑ run.py                  # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ üìÑ face_recognition.db     # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ üìÑ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

–ü–æ—Ä–æ–≥ `FACE_RECOGNITION_THRESHOLD` –≤ `.env` –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç—Ä–æ–≥–æ—Å—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:

- **0.4-0.5** - –ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –±–æ–ª—å—à–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
- **0.6** - ‚≠ê –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)  
- **0.7-0.8** - –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è CPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
OMP_NUM_THREADS=1           # –ü–æ—Ç–æ–∫–∏ OpenMP
ONNX_NUM_THREADS=1          # –ü–æ—Ç–æ–∫–∏ ONNX Runtime
INSIGHTFACE_ROOT=./models_cache  # –ö—ç—à –º–æ–¥–µ–ª–µ–π

# –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
MAX_UPLOAD_SIZE=10485760    # 10MB –º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä
```

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

**‚úÖ –•–æ—Ä–æ—à–∏–µ —Ñ–æ—Ç–æ:**
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç 200x200 –ø–∏–∫—Å–µ–ª–µ–π
- –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –ª–∏—Ü–∞
- –õ–∏—Ü–æ –∑–∞–Ω–∏–º–∞–µ—Ç >10% –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ß–µ—Ç–∫–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–∞–∑–º—ã—Ç–∏—è
- –§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–ª–∏ –ø–æ–ª—É—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∫—É—Ä—Å

**‚ùå –ü–ª–æ—Ö–∏–µ —Ñ–æ—Ç–æ:**
- –°–ª–∏—à–∫–æ–º —Ç–µ–º–Ω—ã–µ –∏–ª–∏ –ø–µ—Ä–µ—Å–≤–µ—á–µ–Ω–Ω—ã–µ
- –°–∏–ª—å–Ω–æ–µ —Ä–∞–∑–º—ã—Ç–∏–µ –∏–ª–∏ —à—É–º
- –õ–∏—Ü–æ —Å–±–æ–∫—É (>45¬∞ –ø–æ–≤–æ—Ä–æ—Ç)
- –ó–∞–∫—Ä—ã—Ç–æ–µ –ª–∏—Ü–æ (–º–∞—Å–∫–∞, –æ—á–∫–∏, –≤–æ–ª–æ—Å—ã)
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–µ–Ω–µ–µ 100x100 –ø–∏–∫—Å–µ–ª–µ–π

### üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```python
# –í face_service.py –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ—Ç–µ–∫—Ü–∏–∏:
self.face_app.prepare(
    ctx_id=0,                    # GPU: 0+, CPU: -1
    det_size=(640, 640),         # –†–∞–∑–º–µ—Ä –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ (–±–æ–ª—å—à–µ = —Ç–æ—á–Ω–µ–µ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
    det_thresh=0.5               # –ü–æ—Ä–æ–≥ –¥–µ—Ç–µ–∫—Ü–∏–∏ –ª–∏—Ü–∞
)
```



## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
black app/
isort app/

# –¢–∏–ø–∏–∑–∞—Ü–∏—è
mypy app/
```

### üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
pip install gunicorn

# –ó–∞–ø—É—Å–∫ —Å Gunicorn
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker \
    --bind 0.0.0.0:8000 --timeout 300

# Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker build -t face-recognition-system .
docker run -p 8000:8000 -v ./uploads:/app/uploads face-recognition-system
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://127.0.0.1:8000/docs
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://127.0.0.1:8000/redoc  
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: http://127.0.0.1:8000/api/health
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã**: http://127.0.0.1:8000/api/stats

### üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **üè† –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [github.com/naumovmag/FaceId](https://github.com/naumovmag/FaceId)
- **üìö InsightFace**: [github.com/deepinsight/insightface](https://github.com/deepinsight/insightface)
- **‚ö° FastAPI**: [fastapi.tiangolo.com](https://fastapi.tiangolo.com)
- **üóÑÔ∏è SQLAlchemy**: [sqlalchemy.org](https://www.sqlalchemy.org)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–°–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö.

## üë• –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä—ã

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ Python-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

‚≠ê **–ü–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É –ø—Ä–æ–µ–∫—Ç—É, –µ—Å–ª–∏ –æ–Ω –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–ª–µ–∑–Ω—ã–º!**